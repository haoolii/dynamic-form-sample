<div class="container">
  <!-- å·¦å´ Tabs -->
  <div class="tabs">
    <div class="tabs-header">
      <h3>Tabs</h3>
      <!-- <button type="button" (click)="addTab('NEW_TAB')">ï¼‹</button> -->
         <div class="tabs-header">
          <label>
            <input type="checkbox" [checked]="allEnabled()" (change)="allEnabled.set(!allEnabled()); toggleAllEnabled()" />
            All Enabled
          </label>
          <button type="button" (click)="addTab('NEW_TAB')">ï¼‹</button>
        </div>
    </div>

    @for (m of meta(); track $index) {
      <div
        class="tab-item"
        [class.active]="activeIndex() === $index"
        [class.disabled]="!m.enabled"
        (click)="activeIndex.set($index)"
      >
        <span>{{ m.label }} ({{ formArray.at($index)?.get('children')?.value?.length ?? 0 }})</span>
        <div class="tab-status">
          @if (m.edited) { <span class="dot"></span> }
          @if (!m.enabled) { <span class="disabled-mark">âœ–</span> }
          <button (click)="removeTab($index); $event.stopPropagation()">ğŸ—‘ï¸</button>
        </div>
      </div>
    }
  </div>

  <!-- å³å´è¡¨å–® -->
  <div class="content" *ngIf="currentForm()">
    <form [formGroup]="currentForm()">
      <label>
        <input type="checkbox" formControlName="enabled" />
        Enabled
      </label>

      <h4>Conditions</h4>
      <div formArrayName="children">
        @for (child of currentChildren.controls; track $index) {
          <div class="child-item" [formGroupName]="$index">
            <input placeholder="field" formControlName="field" />
            <input placeholder="operator" formControlName="operator" />
            <input placeholder="value" formControlName="value" />
            <button type="button" (click)="removeChild($index)">ï¼</button>
          </div>
        }
      </div>
      <button type="button" (click)="addChild()">ï¼‹ Add Condition</button>

      <div class="actions">
        <button type="button" (click)="save(activeIndex())">ğŸ’¾ Save</button>
      </div>
    </form>
  </div>
</div>

<div class="footer">
  <button (click)="submitAll()">Submit All</button>
  <button (click)="exit()">Exit</button>
</div>

<pre>
  {{ formArray.value | json }}
</pre>
